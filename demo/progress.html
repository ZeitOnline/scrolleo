<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Scrollama Demo: Progress</title>
	<meta name="description" content="Scrollama Demo: Progress tracking with visual feedback" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link rel="stylesheet" href="style.css" />
	<style>
		#scrolly {
			position: relative;
		}

		article {
			position: relative;
			padding: 0 1rem;
			margin: 0 auto;
			width: 33%;
		}

		.step {
			margin: 2rem auto 4rem auto;
			padding: 1rem;
			border: 2px solid var(--color-bg);
			min-height: 300px;
			position: relative;
		}

		.step p {
			text-align: center;
			margin: 0.5rem auto;
			font-size: var(--font-size-lg);
		}

		/* Fixed progress indicator that stays visible */
		#progress-indicator {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			color: var(--color-primary);
			background: rgba(255, 255, 255, 0.85);
			padding: 0.75rem 1.25rem;
			border-radius: 20px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			z-index: 1000;
			pointer-events: none;
			transition: opacity 0.3s ease;
			text-align: center;
			backdrop-filter: blur(10px);
		}

		#progress-indicator.hidden {
			opacity: 0;
			pointer-events: none;
		}

		#progress-indicator .step-label {
			font-size: 0.75rem;
			color: var(--color-text-light);
			margin-bottom: 0.25rem;
			text-transform: uppercase;
			letter-spacing: 0.05em;
		}

		#progress-indicator .progress-value {
			font-size: 1.5rem;
			font-weight: 600;
			line-height: 1;
			color: var(--color-primary);
		}

		#outro {
			height: 200vh;
		}
	</style>
</head>
<body>
	<main>
		<nav>
			<a href="index.html">scrollama.js</a>
			<div class="nav__examples">
				<p>Examples:</p>
				<a href="basic.html">Basic</a>
				<a href="progress.html">Progress</a>
				<a href="sticky-side.html">Sticky Side</a>
				<a href="sticky-overlay.html">Sticky Overlay</a>
				<a href="percentage-offset.html">Percentage Offset</a>
				<a href="pixel-offset.html">Pixel Offset</a>
				<a href="multiple.html">Multiple Instances</a>
				<a href="scroll-parent.html">Nested Scroll Container</a>
				<a href="performance-test.html">Performance Test</a>
			</div>
		</nav>
		<section id="intro">
			<h1 class="intro__hed">Progress Example</h1>
			<p class="intro__dek">
				Start scrolling to see how it works.
			</p>
		</section>
		<section id="scrolly">
			<article>
				<div class="step" data-step="218,165,32">
					<p>STEP 1</p>
				</div>
				<div class="step" data-step="0,128,128">
					<p>STEP 2</p>
				</div>
			</article>
		</section>
		<section id="outro"></section>
	</main>

	<!-- Fixed progress indicator -->
	<div id="progress-indicator" class="hidden">
		<div class="step-label">Progress</div>
		<div class="progress-value">0%</div>
	</div>

	<script src="../build/scrollama.js"></script>
	<script src="debug-utils.js"></script>
	<script>
		const scrolly = document.querySelector("#scrolly");
		const article = scrolly.querySelector("article");
		const steps = article.querySelectorAll(".step");
		const progressIndicator = document.getElementById("progress-indicator");
		const progressValue = progressIndicator.querySelector(".progress-value");
		const stepLabel = progressIndicator.querySelector(".step-label");

		// Initialize scrollama
		const scroller = scrollama();

		// Setup options
		const setupOptions = {
			step: "#scrolly article .step",
			progress: true,
			debug: false
		};

		// Format percentage helper
		function formatPercent(value) {
			return (value * 100).toFixed(1) + "%";
		}

		function handleStepEnter(response) {
			// Show progress indicator when step enters
			progressIndicator.classList.remove("hidden");
			const stepNum = response.index + 1;
			stepLabel.textContent = `Step ${stepNum} Progress`;
		}

		function handleStepExit(response) {
			// Hide progress indicator when step exits
			progressIndicator.classList.add("hidden");
		}

		function handleStepProgress(response) {
			console.log(response);
			const el = response.element;
			const val = el.getAttribute("data-step");
			const rgba = `rgba(${val}, ${response.progress})`;
			el.style.backgroundColor = rgba;
			
			// Update fixed progress indicator
			progressValue.textContent = formatPercent(response.progress);
		}

		function resize() {
			// Make steps tall enough to scroll through and see progress
			// Use consistent but different sizes for each step
			const baseHeight = window.innerHeight * 1.5;
			const sizeMultipliers = [1.0, 1.3]; // Different but consistent sizes
			
			steps.forEach((step, index) => {
				const h = baseHeight * sizeMultipliers[index] || baseHeight;
				step.style.height = Math.floor(h) + "px";
			});
			scroller.resize();
		}

		function init() {
			// Set initial step heights before setup
			resize();

			// Setup scrollama
			scroller
				.setup(setupOptions)
				.onStepEnter(handleStepEnter)
				.onStepExit(handleStepExit)
				.onStepProgress(handleStepProgress);

			// Setup resize event listener
			window.addEventListener("resize", resize);

			// Create debug toggle with event handlers
			createDebugToggle(scroller, setupOptions, {
				onStepEnter: handleStepEnter,
				onStepExit: handleStepExit,
				onStepProgress: handleStepProgress
			});
		}

		// Initialize
		init();
	</script>
</body>
</html>
